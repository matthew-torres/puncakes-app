<!DOCTYPE html>
<html>
  <head>
    <title>Customer Orders</title>
    <style>
        table, td, th {
          width: 30em;
          border: 2px solid brown;
        }
        table {
          border-collapse: collapse;
        }
        table td:nth-child(2) { text-align: end; }
        table td:nth-child(3) { text-align: end; }
        table td:nth-child(4) { text-align: end; }
        body {
            background-color: #e6ebef;
        }
   </style>
  </head>
  <body>
  <header>
    <h1>The Puncakes Bakery</h1>
    <nav>
      <ul>
        <li><a href="/">Home</a></li>
        <li><a href="/products">Products</a></li>
        <li><a href="/orders">Orders</a></li>
        <li><a href="/aboutus">About Us</a></li>
        <li><a href="/contact">Contact Us</a></li>
        <li><a href="/faq">FAQ</a></li>
      </ul>
    </nav>
  </header>
    <h2>Orders Catalog</h2>
    <table id="orders-table">
      <thead>
        <tr>
          <th>Select</th>
          <th>OID</th>
          <th>CID</th>
          <th>Total Amount</th>
          <th>Time Placed</th>
          <th>Order Status</th>
        </tr>
      </thead>
      <tbody>
        {% for order in orders %}
        <tr>
          <td><input type="checkbox" name="order_ids[]" value="{{ order[0] }}"></td>
          <td>{{ order[0] }}</td>
          <td>{{ order[1] }}</td>
          <td>{{ order[2] }}</td>
          <td>{{ order[3] }}</td>
          <td>{{ order[5] }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    <button id="process-orders-button">Process Selected Orders</button>
    <a href="/">Return to Home Page</a>
    <script>
      const processOrdersButton = document.getElementById("process-orders-button");
      const ordersTable = document.getElementById("orders-table");
      processOrdersButton.addEventListener("click", (event) => {
        event.preventDefault();
        const selectedOrders = [];
        const checkboxes = ordersTable.querySelectorAll("input[type='checkbox'][name='order_ids[]']");
        checkboxes.forEach((checkbox) => {
          if (checkbox.checked) {
            const row = checkbox.parentNode.parentNode;
            const columns = row.querySelectorAll("td");
            const order = {
              oid: columns[1].textContent,
              cid: columns[2].textContent,
              total_amount: columns[3].textContent,
              time_placed: columns[4].textContent,
              order_status: columns[5].textContent,
            };
            selectedOrders.push(order);
          }
        });
        fetch("/process_orders", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(selectedOrders),
        })
          .then((response) => response.json())
          .then((data) => {
            console.log(data);
            window.location.href = "/orders";
          })
          .catch((error) => {
            console.error(error);
          });
      });
    </script>
    <footer>
        <p>&copy; Puncakes Bakery 2023</p>
    </footer>
  </body>
</html>
